<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç·Šæ€¥æ¸…é™¤å¾…åŒæ­¥è³‡æ–™</title>
</head>
<body>
    <h1>ç·Šæ€¥æ¸…é™¤å¾…åŒæ­¥è³‡æ–™å·¥å…·</h1>
    <button id="clearBtn">ç«‹å³æ¸…é™¤ pendingPush</button>
    <div id="result"></div>

    <script>
    document.getElementById('clearBtn').addEventListener('click', function() {
        const resultDiv = document.getElementById('result');
        let results = [];

        // æª¢æŸ¥æ˜¯å¦æœ‰ pendingPush
        const pendingPush = localStorage.getItem('pendingPush');
        if (pendingPush) {
            try {
                const data = JSON.parse(pendingPush);
                results.push('ğŸ” ç™¼ç¾ pendingPush è³‡æ–™:');
                results.push(`  - assignments æ•¸é‡: ${data.assignments ? Object.keys(data.assignments).length : 0}`);

                // æª¢æŸ¥æ˜¯å¦åŒ…å«å°ˆæ¡ˆå‚™è¨»
                if (data.assignments) {
                    Object.keys(data.assignments).forEach(projectId => {
                        const project = data.assignments[projectId];
                        if (project.notes) {
                            results.push(`  - ${projectId}: æœ‰å°ˆæ¡ˆå‚™è¨»`);
                        } else {
                            results.push(`  - ${projectId}: ç„¡å°ˆæ¡ˆå‚™è¨» âŒ`);
                        }
                    });
                }

                // æ¸…é™¤ pendingPush
                localStorage.removeItem('pendingPush');
                results.push('âœ… å·²æ¸…é™¤ pendingPush');

            } catch (e) {
                results.push('âš ï¸ pendingPush è³‡æ–™è§£æå¤±æ•—: ' + e.message);
                localStorage.removeItem('pendingPush');
                results.push('âœ… å·²å¼·åˆ¶æ¸…é™¤æå£çš„ pendingPush');
            }
        } else {
            results.push('â„¹ï¸ æ²’æœ‰ç™¼ç¾ pendingPush è³‡æ–™');
        }

        // ä¹Ÿæ¸…é™¤å…¶ä»–å¯èƒ½çš„å•é¡Œè³‡æ–™
        const keysToCheck = [
            'teamAssignments',
            'cachedProjectAssignments',
            'teamAssignments_backup'
        ];

        keysToCheck.forEach(key => {
            const data = localStorage.getItem(key);
            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    if (parsed && typeof parsed === 'object') {
                        if (key === 'teamAssignments' || key === 'cachedProjectAssignments') {
                            // æª¢æŸ¥å°ˆæ¡ˆå‚™è¨»
                            let hasNotes = false;
                            Object.keys(parsed).forEach(projectId => {
                                if (parsed[projectId] && parsed[projectId].notes) {
                                    hasNotes = true;
                                }
                            });
                            results.push(`ğŸ“‹ ${key}: ${Object.keys(parsed).length} å€‹å°ˆæ¡ˆ, å°ˆæ¡ˆå‚™è¨»: ${hasNotes ? 'æœ‰' : 'ç„¡ âŒ'}`);
                        } else if (parsed.assignments) {
                            let hasNotes = false;
                            Object.keys(parsed.assignments).forEach(projectId => {
                                if (parsed.assignments[projectId] && parsed.assignments[projectId].notes) {
                                    hasNotes = true;
                                }
                            });
                            results.push(`ğŸ“‹ ${key}: ${Object.keys(parsed.assignments).length} å€‹å°ˆæ¡ˆ, å°ˆæ¡ˆå‚™è¨»: ${hasNotes ? 'æœ‰' : 'ç„¡ âŒ'}`);
                        }
                    }
                } catch (e) {
                    results.push(`âš ï¸ ${key} è§£æå¤±æ•—: ${e.message}`);
                }
            }
        });

        results.push('<br><strong>å»ºè­°ï¼šé‡æ–°è¼‰å…¥é¦–é ä¸¦æª¢æŸ¥å°ˆæ¡ˆå‚™è¨»æ˜¯å¦æ­£å¸¸</strong>');

        resultDiv.innerHTML = results.join('<br>');
    });
    </script>
</body>
</html>