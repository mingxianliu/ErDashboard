<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç ”ç™¼è¨˜éŒ„ç°¿ - ä»»å‹™ç·¨çµ„ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="css/dashboard.css?v=20250918x" rel="stylesheet">
    <meta name="description" content="ç ”ç™¼è¨˜éŒ„ç°¿ - è¨˜éŒ„é–‹ç™¼éç¨‹ä¸­çš„é‡è¦äº‹é …">
    <meta name="robots" content="noindex,nofollow">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="fas fa-clipboard-list me-2"></i>
                ç ”ç™¼è¨˜éŒ„ç°¿
            </span>
            <div class="d-flex align-items-center">
                <span class="badge bg-light text-dark me-2" id="lastUpdate">è¼‰å…¥ä¸­...</span>
                <button class="btn btn-success btn-sm me-2" id="syncBtn" style="display: none;" title="åŒæ­¥åˆ° Google Drive">
                    <i class="fas fa-cloud-upload-alt"></i> Push
                </button>
                <button class="btn btn-info btn-sm me-2" id="pullBtn" style="display: none;" title="å¾ Google Drive æ‹‰å–">
                    <i class="fas fa-cloud-download-alt"></i> Pull
                </button>
                <button class="btn btn-outline-light btn-sm me-2" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i> é‡æ–°è¼‰å…¥
                </button>
                <button class="btn btn-secondary btn-sm" onclick="window.location.href='index.html'">
                    <i class="fas fa-home"></i> è¿”å›é¦–é 
                </button>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">

        <!-- ç§é‘°é©—è­‰ -->
        <div id="keyAuthentication" class="text-center py-5" style="display: none;">
            <div class="card mx-auto" style="max-width: 600px;">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-key me-2"></i>éœ€è¦ç™»å…¥
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">è«‹å…ˆç™»å…¥ ErDashboard ç³»çµ±æ‰èƒ½ä½¿ç”¨ç ”ç™¼è¨˜éŒ„ç°¿ã€‚</p>
                    <button class="btn btn-primary" onclick="window.location.href='index.html'">
                        <i class="fas fa-home me-2"></i>å›åˆ°é¦–é ç™»å…¥
                    </button>
                </div>
            </div>
        </div>

        <!-- åŠŸèƒ½åˆ†é  -->
        <ul class="nav nav-tabs" id="devLogTabs" role="tablist" style="display: none;">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="global-tab" data-bs-toggle="tab" data-bs-target="#global" type="button" role="tab">
                    <i class="fas fa-globe me-2"></i>ç¸½é«”è¨˜éŒ„
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="projects-tab" data-bs-toggle="tab" data-bs-target="#projects" type="button" role="tab">
                    <i class="fas fa-folder-open me-2"></i>å°ˆæ¡ˆè¨˜éŒ„
                </button>
            </li>
        </ul>

        <div class="tab-content" id="devLogTabContent" style="display: none;">

            <!-- ç¸½é«”è¨˜éŒ„ -->
            <div class="tab-pane fade show active" id="global" role="tabpanel">
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-globe me-2"></i>ç¸½é«”ç ”ç™¼è¨˜éŒ„
                                </h5>
                                <div>
                                    <button class="btn btn-danger btn-sm" id="clearGlobalBtn" title="æ¸…ç©ºæ‰€æœ‰ç¸½é«”è¨˜éŒ„">
                                        <i class="fas fa-trash-alt"></i> æ¸…ç©º
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- æ–°å¢è¨˜éŒ„è¡¨å–® -->
                                <div class="mb-4">
                                    <div class="row">
                                        <div class="col-md-10">
                                            <textarea class="form-control" id="globalLogInput" rows="3"
                                                      placeholder="è¼¸å…¥æ–°çš„ç ”ç™¼è¨˜éŒ„å…§å®¹..."></textarea>
                                        </div>
                                        <div class="col-md-2">
                                            <button class="btn btn-primary w-100" id="addGlobalLogBtn">
                                                <i class="fas fa-plus"></i> æ–°å¢è¨˜éŒ„
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- è¨˜éŒ„åˆ—è¡¨ -->
                                <div id="globalLogsList">
                                    <div class="text-center text-muted">
                                        <i class="fas fa-spinner fa-spin fa-2x"></i>
                                        <p class="mt-2">è¼‰å…¥ä¸­...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å°ˆæ¡ˆè¨˜éŒ„ -->
            <div class="tab-pane fade" id="projects" role="tabpanel">
                <div class="row mt-4">
                    <div class="col-12">

                        <!-- å°ˆæ¡ˆé¸æ“‡ -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-6">
                                        <label class="form-label">é¸æ“‡å°ˆæ¡ˆï¼š</label>
                                        <select class="form-select" id="projectSelect">
                                            <option value="">é¸æ“‡è¦æŸ¥çœ‹çš„å°ˆæ¡ˆ</option>
                                            <!-- å‹•æ…‹è¼‰å…¥å°ˆæ¡ˆé¸é … -->
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-outline-info btn-sm" id="refreshProjectsBtn">
                                                <i class="fas fa-sync-alt"></i> é‡æ–°è¼‰å…¥å°ˆæ¡ˆ
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- å°ˆæ¡ˆè¨˜éŒ„å…§å®¹ -->
                        <div class="card" id="projectLogCard" style="display: none;">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-folder-open me-2"></i>
                                    <span id="currentProjectName">å°ˆæ¡ˆè¨˜éŒ„</span>
                                </h5>
                                <div>
                                    <button class="btn btn-danger btn-sm" id="clearProjectBtn" title="æ¸…ç©ºæ­¤å°ˆæ¡ˆçš„æ‰€æœ‰è¨˜éŒ„">
                                        <i class="fas fa-trash-alt"></i> æ¸…ç©º
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- æ–°å¢è¨˜éŒ„è¡¨å–® -->
                                <div class="mb-4">
                                    <div class="row">
                                        <div class="col-md-10">
                                            <textarea class="form-control" id="projectLogInput" rows="3"
                                                      placeholder="è¼¸å…¥æ–°çš„å°ˆæ¡ˆè¨˜éŒ„å…§å®¹..."></textarea>
                                        </div>
                                        <div class="col-md-2">
                                            <button class="btn btn-primary w-100" id="addProjectLogBtn">
                                                <i class="fas fa-plus"></i> æ–°å¢è¨˜éŒ„
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- è¨˜éŒ„åˆ—è¡¨ -->
                                <div id="projectLogsList">
                                    <div class="text-center text-muted">
                                        <p>è«‹å…ˆé¸æ“‡å°ˆæ¡ˆ</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- åˆªé™¤ç¢ºèªæ¨¡æ…‹æ¡† -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ç¢ºèªåˆªé™¤</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="deleteMessage">ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨˜éŒ„å—ï¼Ÿ</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">ç¢ºèªåˆªé™¤</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/crypto-auth.js?v=20250918p"></script>
    <script src="js/markdown-reader.js?v=20250919d"></script>
    <script>
        // å˜—è©¦è¼‰å…¥ config.js
        const configScript = document.createElement('script');
        configScript.src = 'js/config.js?v=20250918t';
        configScript.onerror = () => {
            console.log('âš ï¸ config.js æœªæ‰¾åˆ°ï¼Œå°‡ä½¿ç”¨æ‰‹å‹•è¨­å®šæ¨¡å¼');
        };
        document.head.appendChild(configScript);
    </script>
    <script src="js/google-drive-api.js?v=20250923a"></script>
    <script src="js/team-data-manager.js?v=20250918u"></script>
    <script src="js/dev-log.js?v=20250923c"></script>
    <script src="js/dev-log-ui.js?v=20250923f"></script>
    <script>
        // åˆå§‹åŒ–ç ”ç™¼è¨˜éŒ„ç°¿
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('ğŸ“‹ é–‹å§‹è¼‰å…¥ç ”ç™¼è¨˜éŒ„ç°¿...');

                // æª¢æŸ¥èªè­‰ç‹€æ…‹
                const hasAuth = sessionStorage.getItem('KEY_AUTHENTICATED');
                const hasGDriveConfig = sessionStorage.getItem('GOOGLE_DRIVE_CONFIG');

                if (!hasAuth || !hasGDriveConfig) {
                    console.log('âš ï¸ æœªç™»å…¥ï¼Œé¡¯ç¤ºç™»å…¥æç¤º');
                    document.getElementById('keyAuthentication').style.display = 'block';
                    return;
                }

                // ç­‰å¾…æ‰€æœ‰è…³æœ¬è¼‰å…¥
                console.log('ğŸ”„ ç­‰å¾…è…³æœ¬è¼‰å…¥...');
                await new Promise(resolve => {
                    if (window.DevLogUI && window.DevLogManager && window.TeamDataManager && window.googleDriveAPI) {
                        console.log('âœ… æ‰€æœ‰è…³æœ¬å·²è¼‰å…¥');
                        resolve();
                    } else {
                        let checkCount = 0;
                        const checkInterval = setInterval(() => {
                            checkCount++;
                            console.log(`â³ æª¢æŸ¥è…³æœ¬è¼‰å…¥ç‹€æ…‹... (${checkCount}/50)`, {
                                DevLogUI: !!window.DevLogUI,
                                DevLogManager: !!window.DevLogManager,
                                TeamDataManager: !!window.TeamDataManager,
                                googleDriveAPI: !!window.googleDriveAPI
                            });

                            if (window.DevLogUI && window.DevLogManager && window.TeamDataManager && window.googleDriveAPI) {
                                clearInterval(checkInterval);
                                console.log('âœ… æ‰€æœ‰è…³æœ¬å·²è¼‰å…¥');
                                resolve();
                            } else if (checkCount > 50) { // 5ç§’è¶…æ™‚
                                clearInterval(checkInterval);
                                console.error('âŒ è…³æœ¬è¼‰å…¥è¶…æ™‚');
                                resolve();
                            }
                        }, 100);
                    }
                });

                // åˆå§‹åŒ– devLogManager
                if (!window.devLogManager) {
                    console.log('ğŸ”„ åˆå§‹åŒ– DevLogManager...');
                    window.devLogManager = new DevLogManager();
                }

                // åˆå§‹åŒ– devLogUI
                if (!window.devLogUI) {
                    console.log('ğŸ”„ åˆå§‹åŒ– DevLogUI...');
                    window.devLogUI = new DevLogUI();
                }

                // å•Ÿå‹• UI
                console.log('ğŸš€ å•Ÿå‹• DevLogUI...');
                await window.devLogUI.init();

                console.log('âœ… ç ”ç™¼è¨˜éŒ„ç°¿åˆå§‹åŒ–å®Œæˆ');

            } catch (error) {
                console.error('âŒ ç ”ç™¼è¨˜éŒ„ç°¿åˆå§‹åŒ–å¤±æ•—:', error);

                // æª¢æŸ¥æ˜¯å¦æ˜¯èªè­‰å•é¡Œ
                if (error.message.includes('Google Drive') || error.message.includes('èªè­‰') || error.message.includes('ç™»å…¥')) {
                    document.getElementById('keyAuthentication').style.display = 'block';
                    document.getElementById('keyAuthentication').innerHTML = `
                        <div class="card mx-auto" style="max-width: 600px;">
                            <div class="card-header bg-warning text-white">
                                <h5 class="mb-0">
                                    <i class="fas fa-exclamation-triangle me-2"></i>éœ€è¦é‡æ–°ç™»å…¥
                                </h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted">æ‚¨çš„ç™»å…¥ç‹€æ…‹å·²éæœŸæˆ–ç„¡æ•ˆï¼Œè«‹å›åˆ°é¦–é é‡æ–°ç™»å…¥ã€‚</p>
                                <p class="text-danger small">éŒ¯èª¤è¨Šæ¯ï¼š${error.message}</p>
                                <button class="btn btn-primary" onclick="window.location.href='index.html'">
                                    <i class="fas fa-home me-2"></i>å›åˆ°é¦–é ç™»å…¥
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    // å…¶ä»–éŒ¯èª¤
                    document.getElementById('keyAuthentication').style.display = 'block';
                    document.getElementById('keyAuthentication').innerHTML = `
                        <div class="card mx-auto" style="max-width: 600px;">
                            <div class="card-header bg-danger text-white">
                                <h5 class="mb-0">
                                    <i class="fas fa-exclamation-triangle me-2"></i>è¼‰å…¥å¤±æ•—
                                </h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted">ç ”ç™¼è¨˜éŒ„ç°¿è¼‰å…¥å¤±æ•—ï¼Œè«‹å˜—è©¦ä»¥ä¸‹è§£æ±ºæ–¹æ¡ˆï¼š</p>
                                <p class="text-danger small">éŒ¯èª¤è¨Šæ¯ï¼š${error.message}</p>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary" onclick="window.location.reload()">
                                        <i class="fas fa-sync-alt me-2"></i>é‡æ–°æ•´ç†é é¢
                                    </button>
                                    <button class="btn btn-secondary" onclick="window.location.href='index.html'">
                                        <i class="fas fa-home me-2"></i>å›åˆ°é¦–é 
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
        });
    </script>
</body>
</html>