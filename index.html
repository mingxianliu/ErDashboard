<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šå°ˆæ¡ˆé€²åº¦ç›£æ§ä¸­å¿ƒ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="css/dashboard.css?v=20250918p" rel="stylesheet">
    <meta name="description" content="åŸºæ–¼ Markdown æª”æ¡ˆçš„å°ˆæ¡ˆé€²åº¦ç›£æ§å„€è¡¨æ¿">
    <meta name="robots" content="noindex,nofollow">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="fas fa-tachometer-alt me-2"></i>
                å¤šå°ˆæ¡ˆé€²åº¦ç›£æ§ä¸­å¿ƒ
            </span>
            <div class="d-flex align-items-center">
                <span class="badge bg-light text-dark me-2" id="lastUpdate">è¼‰å…¥ä¸­...</span>
                <button class="btn btn-success btn-sm me-2" id="syncBtn" style="display: none;" title="åŒæ­¥æœ¬åœ°æª”æ¡ˆåˆ° Google Drive">
                    <i class="fas fa-cloud-upload-alt"></i> Push
                </button>
                <button class="btn btn-info btn-sm me-2" id="pullBtn" style="display: none;" title="å¾ Google Drive æ‹‰å–æœ€æ–°è³‡æ–™åˆ°æœ¬åœ°">
                    <i class="fas fa-cloud-download-alt"></i> Pull
                </button>
                <button class="btn btn-outline-light btn-sm me-2" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i> é‡æ–°è¼‰å…¥
                </button>
                <button class="btn btn-warning btn-sm me-2" id="teamManagementBtn" style="display: none;">
                    <i class="fas fa-users-cog"></i> åœ˜éšŠç®¡ç†
                </button>
                <button class="btn btn-danger btn-sm" id="logoutBtn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> ç™»å‡º
                </button>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">

        <!-- ç§é‘°é©—è­‰ -->
        <div id="keyAuthentication" class="text-center py-5" style="display: none;">
            <div class="card mx-auto" style="max-width: 600px;">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-key me-2"></i>ç§é‘°é©—è­‰
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">æ­¤ Dashboard éœ€è¦ Google Drive è¨­å®šå’Œç§é‘°æ‰èƒ½ä½¿ç”¨ã€‚è«‹ä¾åºåŒ¯å…¥ï¼š</p>

                    <!-- Google Drive è¨­å®šå€åŸŸ -->
                    <div class="mb-4">
                        <label class="form-label">1. Google Drive è¨­å®š (JSON æ ¼å¼)</label>
                        <textarea class="form-control" id="googleConfigInput" rows="5"
                                  placeholder='{
  "CLIENT_ID": "æ‚¨çš„-client-id.apps.googleusercontent.com",
  "FOLDER_ID": "YOUR_FOLDER_ID_HERE",
  "SCOPES": "https://www.googleapis.com/auth/drive.file"
}'></textarea>
                        <small class="text-muted">Google Drive API è¨­å®šï¼Œåƒ…åœ¨ç€è¦½å™¨ä¸­ä½¿ç”¨</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">2. åŒ¯å…¥ç§é‘° (PEM æ ¼å¼)</label>
                        <textarea class="form-control" id="privateKeyInput" rows="6"
                                  placeholder="-----BEGIN PRIVATE KEY-----
...
-----END PRIVATE KEY-----"></textarea>
                        <small class="text-muted">ç§é‘°åƒ…åœ¨ç€è¦½å™¨ä¸­ä½¿ç”¨ï¼Œä¸æœƒå‚³é€åˆ°ä»»ä½•ä¼ºæœå™¨</small>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" id="verifyKeyBtn">
                                <i class="fas fa-shield-alt me-2"></i>é©—è­‰ä¸¦é€²å…¥
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" id="uploadKeyBtn">
                                <i class="fas fa-upload me-2"></i>å¾æª”æ¡ˆåŒ¯å…¥
                            </button>
                        </div>
                        <input type="file" id="keyFileInput" accept=".pem,.key" style="display: none;">
                    </div>
                    
                    <div class="alert alert-danger mt-3 d-none" id="keyError">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <span id="keyErrorText">ç§é‘°é©—è­‰å¤±æ•—</span>
                    </div>
                    
                    <div class="alert alert-success mt-3 d-none" id="keySuccess">
                        <i class="fas fa-check-circle me-2"></i>
                        ç§é‘°é©—è­‰æˆåŠŸï¼æ­£åœ¨è¼‰å…¥ Dashboard...
                    </div>
                </div>
            </div>
        </div>

        <!-- è¼‰å…¥ç‹€æ…‹ -->
        <div id="loadingSpinner" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">è¼‰å…¥ä¸­...</span>
            </div>
            <div class="mt-3">æ­£åœ¨è¼‰å…¥å°ˆæ¡ˆè³‡æ–™...</div>
        </div>

        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="row" id="summaryCards" style="display: none;">
            <!-- å‹•æ…‹è¼‰å…¥ -->
        </div>


        <!-- å°ˆæ¡ˆåˆ—è¡¨ -->
        <div class="row mt-4" id="projectsList" style="display: none;">
            <!-- å‹•æ…‹è¼‰å…¥ -->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/crypto-auth.js?v=20250918p"></script>
    <script src="js/markdown-reader.js?v=20250918p"></script>
    <script>
        // å˜—è©¦è¼‰å…¥ config.js (æœ¬åœ°ç‰ˆæœ¬)ï¼Œå¦‚æœå¤±æ•—å‰‡å¿½ç•¥ (ç·šä¸Šç‰ˆæœ¬)
        const configScript = document.createElement('script');
        configScript.src = 'js/config.js?v=20250918t';
        configScript.onerror = () => {
            console.log('âš ï¸ config.js æœªæ‰¾åˆ°ï¼Œå°‡ä½¿ç”¨æ‰‹å‹•è¨­å®šæ¨¡å¼');
        };
        document.head.appendChild(configScript);
    </script>
    <script src="js/google-drive-api.js?v=20250918t"></script>
    <script src="js/team-data-manager.js?v=20250918u"></script>
    <script src="js/team-statistics.js?v=20250918u"></script>
    <script src="js/team-ui-components.js?v=20250918u"></script>
    <script src="js/team-management-main.js?v=20250918u"></script>
    <script src="js/markdown-dashboard.js?v=20250918p"></script>
    <script>
        // åš´æ ¼çš„èªè­‰æª¢æŸ¥ - ç„¡ç¹éæ©Ÿåˆ¶
        function checkAuthentication() {
            const isAuthenticated = sessionStorage.getItem('KEY_AUTHENTICATED') === 'true';
            if (!isAuthenticated) {
                // ç¢ºä¿æœªèªè­‰æ™‚å®Œå…¨éš±è—æ‰€æœ‰è³‡æ–™
                document.getElementById('keyAuthentication').style.display = 'block';
                document.getElementById('loadingSpinner').style.display = 'none';
                document.getElementById('summaryCards').style.display = 'none';
                document.getElementById('projectsList').style.display = 'none';
                // ç¦æ­¢åˆå§‹åŒ– Dashboard
                window.markdownDashboard = null;
                return false;
            }
            // å¦‚æœå·²èªè­‰ï¼Œé¡¯ç¤ºç™»å‡ºæŒ‰éˆ•
            showMainDashboard();
            // æª¢æŸ¥ session æ˜¯å¦éæœŸ
            checkSessionTimeout();
            return true;
        }
        
        // ç§é‘°é©—è­‰åŠŸèƒ½
        document.getElementById('verifyKeyBtn').addEventListener('click', async function() {
            const googleConfigJSON = document.getElementById('googleConfigInput').value.trim();
            const privateKeyPEM = document.getElementById('privateKeyInput').value.trim();
            const errorDiv = document.getElementById('keyError');
            const successDiv = document.getElementById('keySuccess');

            // é©—è­‰ Google Drive è¨­å®š
            if (!googleConfigJSON) {
                document.getElementById('keyErrorText').textContent = 'è«‹è¼¸å…¥ Google Drive è¨­å®š';
                errorDiv.classList.remove('d-none');
                successDiv.classList.add('d-none');
                return;
            }

            let googleConfig;
            try {
                googleConfig = JSON.parse(googleConfigJSON);
                if (!googleConfig.CLIENT_ID || !googleConfig.FOLDER_ID || !googleConfig.SCOPES) {
                    throw new Error('è¨­å®šæ ¼å¼ä¸å®Œæ•´');
                }
            } catch (error) {
                document.getElementById('keyErrorText').textContent = `Google Drive è¨­å®šæ ¼å¼éŒ¯èª¤ï¼š${error.message}`;
                errorDiv.classList.remove('d-none');
                successDiv.classList.add('d-none');
                return;
            }

            if (!privateKeyPEM) {
                document.getElementById('keyErrorText').textContent = 'è«‹è¼¸å…¥ç§é‘°';
                errorDiv.classList.remove('d-none');
                successDiv.classList.add('d-none');
                return;
            }
            
            this.disabled = true;
            this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>é©—è­‰ä¸­...';
            
            try {
                // ä½¿ç”¨ Web Crypto API é©—è­‰ç§é‘°
                const isValid = await verifyPrivateKeyWebCrypto(privateKeyPEM);
                
                if (isValid) {
                    // å„²å­˜ Google Drive è¨­å®šåˆ° sessionStorage
                    sessionStorage.setItem('GOOGLE_DRIVE_CONFIG', JSON.stringify(googleConfig));

                    // è¨­å®šç™»å…¥ç‹€æ…‹å’Œæ™‚é–“æˆ³
                    const loginTime = Date.now();
                    sessionStorage.setItem('KEY_AUTHENTICATED', 'true');
                    sessionStorage.setItem('LOGIN_TIME', loginTime.toString());

                    successDiv.classList.remove('d-none');
                    errorDiv.classList.add('d-none');
                    
                    setTimeout(() => {
                        document.getElementById('keyAuthentication').style.display = 'none';
                        showMainDashboard();
                        // å•Ÿå‹•æ–°çš„ Markdown Dashboard
                        window.markdownDashboard = new MarkdownProjectDashboard();
                    }, 1000);
                } else {
                    document.getElementById('keyErrorText').textContent = 'ç§é‘°é©—è­‰å¤±æ•—ï¼Œè«‹ç¢ºèªç§é‘°æ­£ç¢º';
                    errorDiv.classList.remove('d-none');
                    successDiv.classList.add('d-none');
                }
            } catch (error) {
                console.error('Key verification error:', error);
                document.getElementById('keyErrorText').textContent = `é©—è­‰éŒ¯èª¤ï¼š${error.message}`;
                errorDiv.classList.remove('d-none');
                successDiv.classList.add('d-none');
            } finally {
                this.disabled = false;
                this.innerHTML = '<i class="fas fa-shield-alt me-2"></i>é©—è­‰ä¸¦é€²å…¥';
            }
        });
        
        // å¾æª”æ¡ˆåŒ¯å…¥ç§é‘°
        document.getElementById('uploadKeyBtn').addEventListener('click', function() {
            document.getElementById('keyFileInput').click();
        });
        
        document.getElementById('keyFileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    document.getElementById('privateKeyInput').value = event.target.result;
                };
                reader.readAsText(file);
            }
        });
        
        // é¡¯ç¤ºä¸» Dashboard
        function showMainDashboard() {
            document.getElementById('logoutBtn').style.display = 'inline-block';
            document.getElementById('teamManagementBtn').style.display = 'inline-block';
            document.getElementById('syncBtn').style.display = 'inline-block';
            document.getElementById('pullBtn').style.display = 'inline-block';
        }
        
        // ç™»å‡ºåŠŸèƒ½
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿç™»å‡ºå¾Œéœ€è¦é‡æ–°åŒ¯å…¥ç§é‘°ã€‚')) {
                // æ¸…é™¤èªè­‰ç‹€æ…‹
                sessionStorage.removeItem('KEY_AUTHENTICATED');
                sessionStorage.removeItem('LOGIN_TIME');
                
                // éš±è—ç™»å‡ºæŒ‰éˆ•å’Œåœ˜éšŠç®¡ç†æŒ‰éˆ•
                this.style.display = 'none';
                document.getElementById('teamManagementBtn').style.display = 'none';
                document.getElementById('syncBtn').style.display = 'none';
                document.getElementById('pullBtn').style.display = 'none';

                // é¡¯ç¤ºèªè­‰ä»‹é¢
                document.getElementById('keyAuthentication').style.display = 'block';
                document.getElementById('loadingSpinner').style.display = 'none';
                document.getElementById('summaryCards').style.display = 'none';
                document.getElementById('projectsList').style.display = 'none';
                
                // æ¸…ç©ºç§é‘°è¼¸å…¥æ¬„
                document.getElementById('privateKeyInput').value = '';
                
                // éš±è—æˆåŠŸ/éŒ¯èª¤è¨Šæ¯
                document.getElementById('keyError').classList.add('d-none');
                document.getElementById('keySuccess').classList.add('d-none');
                
                console.log('ç”¨æˆ¶å·²ç™»å‡ºï¼Œéœ€è¦é‡æ–°èªè­‰');
            }
        });
        
        // æª¢æŸ¥ Session è¶…æ™‚ï¼ˆ30åˆ†é˜ï¼‰
        function checkSessionTimeout() {
            const loginTime = sessionStorage.getItem('LOGIN_TIME');
            const isAuthenticated = sessionStorage.getItem('KEY_AUTHENTICATED') === 'true';
            
            if (isAuthenticated && loginTime) {
                const now = Date.now();
                const sessionAge = now - parseInt(loginTime);
                const timeout = 30 * 60 * 1000; // 30åˆ†é˜
                
                if (sessionAge > timeout) {
                    alert('æœƒè©±å·²éæœŸï¼Œè«‹é‡æ–°ç™»å…¥');
                    document.getElementById('logoutBtn').click();
                }
            }
        }
        
        // æ¯åˆ†é˜æª¢æŸ¥ä¸€æ¬¡ session
        setInterval(checkSessionTimeout, 60000);

        // é‡æ–°è¼‰å…¥åŠŸèƒ½
        document.getElementById('refreshBtn').addEventListener('click', function() {
            location.reload();
        });

        // Push åŠŸèƒ½ (ä¸Šå‚³åˆ°é›²ç«¯)
        document.getElementById('syncBtn').addEventListener('click', async function() {
            const syncBtn = this;
            const originalText = syncBtn.innerHTML;

            try {
                // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
                syncBtn.disabled = true;
                syncBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ä¸Šå‚³ä¸­...';

                // æª¢æŸ¥ Google Drive é€£ç·š
                if (!window.googleDriveAPI || !window.googleDriveAPI.isAuthenticated) {
                    throw new Error('Google Drive æœªç™»å…¥ï¼Œè«‹å…ˆç™»å…¥');
                }

                await pushLocalFilesToGoogleDrive();

                // æˆåŠŸè¨Šæ¯
                showSyncToast('æ¨é€æˆåŠŸ', 'æœ¬åœ°æª”æ¡ˆå·²æ¨é€åˆ° Google Drive', 'success');

            } catch (error) {
                console.error('åŒæ­¥å¤±æ•—:', error);
                showSyncToast('åŒæ­¥å¤±æ•—', error.message, 'error');
            } finally {
                // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
                syncBtn.disabled = false;
                syncBtn.innerHTML = originalText;
            }
        });

        // Pull åŠŸèƒ½ (å¾é›²ç«¯ä¸‹è¼‰)
        document.getElementById('pullBtn').addEventListener('click', async function() {
            const pullBtn = this;
            const originalText = pullBtn.innerHTML;

            try {
                // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
                pullBtn.disabled = true;
                pullBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ä¸‹è¼‰ä¸­...';

                // æª¢æŸ¥ Google Drive é€£ç·š
                if (!window.googleDriveAPI || !window.googleDriveAPI.isAuthenticated) {
                    throw new Error('Google Drive æœªç™»å…¥ï¼Œè«‹å…ˆç™»å…¥');
                }

                await pullFilesFromGoogleDrive();

                // æˆåŠŸè¨Šæ¯
                showSyncToast('æ‹‰å–æˆåŠŸ', 'å·²å¾ Google Drive æ‹‰å–æœ€æ–°è³‡æ–™', 'success');

                // å»ºè­°é‡æ–°è¼‰å…¥é é¢
                setTimeout(() => {
                    if (confirm('è³‡æ–™å·²æ›´æ–°ï¼Œæ˜¯å¦é‡æ–°è¼‰å…¥é é¢ä»¥é¡¯ç¤ºæœ€æ–°å…§å®¹ï¼Ÿ')) {
                        location.reload();
                    }
                }, 1000);

            } catch (error) {
                console.error('æ‹‰å–å¤±æ•—:', error);
                showSyncToast('æ‹‰å–å¤±æ•—', error.message, 'error');
            } finally {
                // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
                pullBtn.disabled = false;
                pullBtn.innerHTML = originalText;
            }
        });

        // æ¨é€æœ¬åœ°æª”æ¡ˆåˆ° Google Drive
        async function pushLocalFilesToGoogleDrive() {
            const filesToSync = [
                'config/team-members.json',
                'config/project-assignments.json'
            ];

            const syncResults = [];

            for (const filePath of filesToSync) {
                try {
                    console.log(`ğŸ”„ åŒæ­¥æª”æ¡ˆ: ${filePath}`);

                    // è®€å–æœ¬åœ°æª”æ¡ˆ
                    const response = await fetch(filePath + '?v=' + Date.now());
                    if (!response.ok) {
                        throw new Error(`ç„¡æ³•è®€å– ${filePath}: ${response.statusText}`);
                    }

                    const fileContent = await response.text();
                    const fileName = filePath.split('/').pop();

                    // ä¸Šå‚³åˆ° Google Drive
                    await window.googleDriveAPI.saveFile(fileName, fileContent);

                    syncResults.push({
                        file: fileName,
                        status: 'success',
                        message: 'åŒæ­¥æˆåŠŸ'
                    });

                    console.log(`âœ… ${fileName} åŒæ­¥å®Œæˆ`);

                } catch (error) {
                    console.error(`âŒ ${filePath} åŒæ­¥å¤±æ•—:`, error);
                    syncResults.push({
                        file: filePath.split('/').pop(),
                        status: 'error',
                        message: error.message
                    });
                }
            }

            // åŒæ­¥å°ˆæ¡ˆç‹€æ…‹æª”æ¡ˆ (å¦‚æœå­˜åœ¨)
            await syncProjectStatusFiles();

            // è¨˜éŒ„åŒæ­¥çµæœ
            logSyncResults(syncResults);

            return syncResults;
        }

        // å¾ Google Drive æ‹‰å–æª”æ¡ˆåˆ°æœ¬åœ°
        async function pullFilesFromGoogleDrive() {
            const filesToPull = [
                'team-members.json',
                'project-assignments.json'
            ];

            const pullResults = [];

            for (const fileName of filesToPull) {
                try {
                    console.log(`ğŸ”„ å¾ Google Drive æ‹‰å–æª”æ¡ˆ: ${fileName}`);

                    // å¾ Google Drive ä¸‹è¼‰æª”æ¡ˆ
                    const fileContent = await window.googleDriveAPI.loadFile(fileName);

                    if (!fileContent) {
                        throw new Error(`Google Drive ä¸­æ‰¾ä¸åˆ° ${fileName}`);
                    }

                    // é©—è­‰ JSON æ ¼å¼
                    try {
                        JSON.parse(fileContent);
                    } catch (parseError) {
                        throw new Error(`${fileName} æ ¼å¼éŒ¯èª¤: ${parseError.message}`);
                    }

                    // å„²å­˜åˆ° localStorageï¼ˆæ¨¡æ“¬ä¸‹è¼‰åˆ°æœ¬åœ°ï¼‰
                    const storageKey = fileName === 'team-members.json' ? 'cachedTeamMembers' : 'cachedProjectAssignments';
                    localStorage.setItem(storageKey, fileContent);

                    pullResults.push({
                        file: fileName,
                        status: 'success',
                        message: 'æ‹‰å–æˆåŠŸ'
                    });

                    console.log(`âœ… ${fileName} æ‹‰å–å®Œæˆ`);

                } catch (error) {
                    console.error(`âŒ ${fileName} æ‹‰å–å¤±æ•—:`, error);
                    pullResults.push({
                        file: fileName,
                        status: 'error',
                        message: error.message
                    });
                }
            }

            // è¨˜éŒ„æ‹‰å–çµæœ
            logPullResults(pullResults);

            return pullResults;
        }

        // åŒæ­¥å°ˆæ¡ˆç‹€æ…‹æª”æ¡ˆ
        async function syncProjectStatusFiles() {
            const projects = ['ErCore', 'ErNexus', 'ErShield', 'ErTidy'];

            for (const project of projects) {
                try {
                    // é€™è£¡å¯ä»¥è®€å– project-status è³‡æ–™å¤¾ä¸­çš„æª”æ¡ˆ
                    // ç”±æ–¼ç€è¦½å™¨å®‰å…¨é™åˆ¶ï¼Œæˆ‘å€‘å…ˆè¨˜éŒ„åˆ° localStorage
                    console.log(`ğŸ“Š æª¢æŸ¥å°ˆæ¡ˆ ${project} ç‹€æ…‹æª”æ¡ˆ`);
                } catch (error) {
                    console.log(`âš ï¸ å°ˆæ¡ˆ ${project} ç„¡ç‹€æ…‹æª”æ¡ˆ`);
                }
            }
        }

        // é¡¯ç¤ºåŒæ­¥é€šçŸ¥
        function showSyncToast(title, message, type) {
            const toastColor = type === 'success' ? 'text-bg-success' : 'text-bg-danger';
            const icon = type === 'success' ? 'check-circle' : 'exclamation-triangle';

            const toastHtml = `
                <div class="toast ${toastColor}" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header">
                        <i class="fas fa-${icon} me-2"></i>
                        <strong class="me-auto">${title}</strong>
                        <small>å‰›æ‰</small>
                        <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">${message}</div>
                </div>
            `;

            // å‰µå»º toast å®¹å™¨ (å¦‚æœä¸å­˜åœ¨)
            let toastContainer = document.getElementById('toastContainer');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toastContainer';
                toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
                toastContainer.style.zIndex = '1055';
                document.body.appendChild(toastContainer);
            }

            // æ·»åŠ ä¸¦é¡¯ç¤º toast
            const toastElement = document.createElement('div');
            toastElement.innerHTML = toastHtml;
            toastContainer.appendChild(toastElement.firstElementChild);

            const toast = new bootstrap.Toast(toastContainer.lastElementChild);
            toast.show();
        }

        // è¨˜éŒ„æ¨é€çµæœ
        function logSyncResults(results) {
            const timestamp = new Date().toISOString();
            const syncLog = {
                type: 'push',
                timestamp,
                results,
                totalFiles: results.length,
                successCount: results.filter(r => r.status === 'success').length,
                errorCount: results.filter(r => r.status === 'error').length
            };

            // å„²å­˜åˆ° localStorage
            const existingLogs = JSON.parse(localStorage.getItem('syncLogs') || '[]');
            existingLogs.unshift(syncLog);

            // åªä¿ç•™æœ€è¿‘ 50 æ¬¡è¨˜éŒ„
            if (existingLogs.length > 50) {
                existingLogs.splice(50);
            }

            localStorage.setItem('syncLogs', JSON.stringify(existingLogs));
            console.log('ğŸ“ æ¨é€è¨˜éŒ„å·²ä¿å­˜:', syncLog);
        }

        // è¨˜éŒ„æ‹‰å–çµæœ
        function logPullResults(results) {
            const timestamp = new Date().toISOString();
            const pullLog = {
                type: 'pull',
                timestamp,
                results,
                totalFiles: results.length,
                successCount: results.filter(r => r.status === 'success').length,
                errorCount: results.filter(r => r.status === 'error').length
            };

            // å„²å­˜åˆ° localStorage
            const existingLogs = JSON.parse(localStorage.getItem('syncLogs') || '[]');
            existingLogs.unshift(pullLog);

            // åªä¿ç•™æœ€è¿‘ 50 æ¬¡è¨˜éŒ„
            if (existingLogs.length > 50) {
                existingLogs.splice(50);
            }

            localStorage.setItem('syncLogs', JSON.stringify(existingLogs));
            console.log('ğŸ“ æ‹‰å–è¨˜éŒ„å·²ä¿å­˜:', pullLog);
        }

        // åœ˜éšŠç®¡ç†åŠŸèƒ½
        document.getElementById('teamManagementBtn').addEventListener('click', function() {
            if (window.teamManagement) {
                window.teamManagement.openTeamManagementDashboard();
            }
        });

        // å•Ÿå‹• Dashboard
        document.addEventListener('DOMContentLoaded', () => {
            // æª¢æŸ¥æ˜¯å¦å·²é€šéç§é‘°é©—è­‰
            if (!checkAuthentication()) {
                // æœªé©—è­‰ç¦æ­¢åˆå§‹åŒ– Dashboard
                return;
            }
            // åƒ…åœ¨å·²é©—è­‰æ™‚åˆå§‹åŒ– Dashboard
            try {
                console.log('é–‹å§‹åˆå§‹åŒ– Markdown Dashboard...');

                // åˆå§‹åŒ–åœ˜éšŠè³‡æ–™ç®¡ç†å™¨
                if (!window.teamDataManager) {
                    window.teamDataManager = new TeamDataManager();
                    window.teamDataManager.init().catch(error => {
                        console.log('åœ˜éšŠè³‡æ–™ç®¡ç†å™¨åˆå§‹åŒ–å¤±æ•— (å¯èƒ½æœªç™»å…¥ Google Drive):', error.message);
                    });
                }

                window.markdownDashboard = new MarkdownProjectDashboard();
            } catch (error) {
                console.error('Dashboard åˆå§‹åŒ–å¤±æ•—:', error);
            }
        });
    </script>
</body>
</html>