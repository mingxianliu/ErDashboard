<!DOCTYPE html>
<html>
<head>
    <title>ä¿®å¾©ç©ºé …ç›® - æ™ºæ…§ç›£è¦–ç³»çµ±</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; }
        #result { margin-top: 20px; padding: 15px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <h1>ğŸ”§ ä¿®å¾©ç©ºé …ç›®å·¥å…·</h1>
    <p>é€™å€‹å·¥å…·å¯ä»¥åˆªé™¤ã€Œæ™ºæ…§ç›£è¦–ç³»çµ±ã€ç©ºé …ç›®ï¼ˆåœ˜éšŠæˆå“¡(0)ï¼‰</p>

    <button id="fixBtn">åˆªé™¤ã€Œæ™ºæ…§ç›£è¦–ç³»çµ±ã€ç©ºé …ç›®</button>
    <button id="checkBtn">æª¢æŸ¥æ‰€æœ‰é …ç›®ç‹€æ…‹</button>

    <div id="result"></div>

    <script>
    // æª¢æŸ¥é …ç›®ç‹€æ…‹
    document.getElementById('checkBtn').addEventListener('click', function() {
        const resultDiv = document.getElementById('result');

        try {
            // æª¢æŸ¥ localStorage ä¸­çš„åœ˜éšŠæ•¸æ“š
            const teamData = localStorage.getItem('teamData');
            const assignments = localStorage.getItem('assignments');

            let info = '<h3>ğŸ“Š ç•¶å‰æ•¸æ“šç‹€æ…‹:</h3>';

            if (teamData) {
                const data = JSON.parse(teamData);
                info += `<p><strong>teamData:</strong> æ‰¾åˆ° ${Object.keys(data).length} å€‹é …ç›®</p>`;
                info += `<pre>${JSON.stringify(data, null, 2).substring(0, 500)}...</pre>`;
            }

            if (assignments) {
                const data = JSON.parse(assignments);
                info += `<p><strong>assignments:</strong> æ‰¾åˆ° ${Object.keys(data.assignments || {}).length} å€‹åˆ†é…</p>`;
                Object.keys(data.assignments || {}).forEach(project => {
                    const memberCount = Object.keys(data.assignments[project].members || {}).length;
                    info += `<p>â€¢ ${project}: ${memberCount} å€‹æˆå“¡</p>`;
                });
            }

            resultDiv.innerHTML = info;
            resultDiv.className = 'warning';

        } catch (error) {
            resultDiv.innerHTML = 'âŒ æª¢æŸ¥å¤±æ•—: ' + error.message;
            resultDiv.className = 'error';
        }
    });

    // ä¿®å¾©ç©ºé …ç›®
    document.getElementById('fixBtn').addEventListener('click', function() {
        const resultDiv = document.getElementById('result');

        try {
            // æ–¹æ³•1: æ¸…é™¤ localStorage ä¸­çš„ç©ºé …ç›®
            const assignments = localStorage.getItem('assignments');
            if (assignments) {
                const data = JSON.parse(assignments);

                if (data.assignments && data.assignments['æ™ºæ…§ç›£è¦–ç³»çµ±']) {
                    delete data.assignments['æ™ºæ…§ç›£è¦–ç³»çµ±'];
                    localStorage.setItem('assignments', JSON.stringify(data));

                    resultDiv.innerHTML = 'âœ… å·²å¾ localStorage ä¸­åˆªé™¤ã€Œæ™ºæ…§ç›£è¦–ç³»çµ±ã€é …ç›®ï¼<br>è«‹é‡æ–°è¼‰å…¥é é¢æŸ¥çœ‹æ•ˆæœã€‚';
                    resultDiv.className = 'success';

                    // 3ç§’å¾Œè‡ªå‹•é‡æ–°è¼‰å…¥
                    setTimeout(() => {
                        if (window.opener) {
                            window.opener.location.reload();
                        }
                        window.close();
                    }, 3000);

                } else {
                    resultDiv.innerHTML = 'âš ï¸ åœ¨ localStorage ä¸­æ‰¾ä¸åˆ°ã€Œæ™ºæ…§ç›£è¦–ç³»çµ±ã€é …ç›®ã€‚';
                    resultDiv.className = 'warning';
                }
            } else {
                resultDiv.innerHTML = 'âŒ æ‰¾ä¸åˆ° assignments æ•¸æ“šã€‚';
                resultDiv.className = 'error';
            }

        } catch (error) {
            console.error('åˆªé™¤é …ç›®å¤±æ•—:', error);
            resultDiv.innerHTML = 'âŒ åˆªé™¤å¤±æ•—: ' + error.message;
            resultDiv.className = 'error';
        }
    });

    // è‡ªå‹•æª¢æŸ¥ç‹€æ…‹
    setTimeout(() => {
        document.getElementById('checkBtn').click();
    }, 1000);
    </script>
</body>
</html>